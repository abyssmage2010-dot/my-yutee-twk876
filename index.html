<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Nilou vs Varessa: Brutal Edition</title>
    <style>
        body { text-align: center; background: #000; color: white; font-family: 'Arial Black', sans-serif; margin: 0; overflow: hidden; touch-action: manipulation; user-select: none; }
        canvas { background: #0a0a0a; display: block; margin: 0 auto; width: 100vw; height: 50vh; object-fit: contain; border-bottom: 3px solid #600; }
        .ui { display: flex; justify-content: space-around; padding: 10px; background: #050505; }
        .health-bar { width: 42%; height: 18px; background: #200; border: 2px solid #fff; box-shadow: 0 0 15px rgba(255,0,0,0.6); }
        .health-inner { height: 100%; width: 100%; background: #f00; transition: 0.1s; }
        .controls { display: flex; justify-content: space-between; padding: 15px; height: 42vh; align-items: center; background: #080808; }
        .d-pad, .actions { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }
        .btn { width: 75px; height: 75px; background: rgba(255,255,255,0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 28px; border: 2px solid rgba(255,255,255,0.2); color: white; }
        .btn:active { background: rgba(255,0,0,0.7); transform: scale(0.8); border-color: red; }
        #btn-atk { background: rgba(180,0,0,0.4); width: 110px; height: 110px; border-color: #f00; font-size: 18px; }
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); display: flex; align-items: center; justify-content: center; z-index: 100; flex-direction: column; cursor: pointer; }
    </style>
</head>
<body>

    <div id="startOverlay" class="overlay" onclick="startCombat()">
        <h1 style="color:red; font-size: 50px; text-shadow: 0 0 30px red;">BRUTAL FIGHT</h1>
        <p>TAP TO START THE CARNAGE</p>
    </div>

    <div class="ui">
        <div class="health-bar"><div id="p1-hp" class="health-inner" style="background: #00ffff; box-shadow: 0 0 10px #00ffff;"></div></div>
        <div class="health-bar"><div id="p2-hp" class="health-inner"></div></div>
    </div>

    <canvas id="gameCanvas" width="800" height="400"></canvas>

    <div class="controls">
        <div class="d-pad">
            <div></div> <div class="btn" id="btn-up">↑</div> <div></div>
            <div class="btn" id="btn-left">←</div> <div></div> <div class="btn" id="btn-right">→</div>
        </div>
        <div class="actions">
            <div></div> <div></div> <div></div>
            <div></div> <div class="btn" id="btn-atk">FATAL HIT</div> <div></div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        let particles = [], floorStains = [], fatalityDone = false, shake = 0;
        const keys = {};

        const nilouSfx = new Audio('nilou_hurt.mp3');
        const varessaSfx = new Audio('https://cdn.pixabay.com/audio/2022/03/10/audio_510b64687d.mp3');

        const setupBtn = (id, key) => {
            const el = document.getElementById(id);
            el.addEventListener('touchstart', (e) => { e.preventDefault(); keys[key] = true; });
            el.addEventListener('touchend', (e) => { e.preventDefault(); keys[key] = false; });
        };
        setupBtn('btn-up', 'KeyW'); setupBtn('btn-left', 'KeyA'); setupBtn('btn-right', 'KeyD'); setupBtn('btn-atk', 'Space');

        function startCombat() {
            document.getElementById('startOverlay').style.display = 'none';
            nilouSfx.play().then(() => { nilouSfx.pause(); }); 
            gameLoop();
        }

        class Fighter {
            constructor(x, imgSrc, side) {
                this.x = x; this.y = 140; this.w = 180; this.h = 260;
                this.hp =